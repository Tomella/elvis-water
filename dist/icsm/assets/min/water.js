"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var RootCtrl=function(t,e){var n=this;e.getConfig().then(function(t){n.data=t;try{var e=document.createElement("canvas");t.modern=!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(r){t.modern=!1}})};angular.module("WaterApp",["common.altthemes","common.basin","common.header","common.navigation","common.panes","common.storage","common.templates","common.toolbar","explorer.config","explorer.confirm","explorer.drag","explorer.enter","explorer.flasher","explorer.googleanalytics","explorer.httpdata","explorer.info","explorer.message","explorer.modal","explorer.tabs","explorer.version","explorer.map.templates","exp.ui.templates","geo.draw","geo.elevation","geo.geosearch","geo.map","geo.maphelper","geo.measure","icsm.contributors","icsm.side-panel","water.clip","water.download","water.panes","water.regions","water.templates","water.toolbar","water.vector","water.view","ui.bootstrap","ui.bootstrap-slider","ngAutocomplete","ngRoute","ngSanitize","page.footer"]).config(["configServiceProvider","projectsServiceProvider","versionServiceProvider",function(t,e,n){t.location("icsm/resources/config/config.json"),t.dynamicLocation("icsm/resources/config/appConfig.json?t="),n.url("icsm/assets/package.json"),e.setProject("icsm")}]).factory("userService",[function(){function t(){return!0}return{login:t,hasAcceptedTerms:t,setAcceptedTerms:t,getUsername:function(){return"anon"}}}]).controller("RootCtrl",RootCtrl),RootCtrl.$invoke=["$http","configService"],angular.module("water.clip",["geo.draw"]).directive("waterInfoBbox",function(){return{restrict:"AE",templateUrl:"water/clip/infobbox.html"}}).directive("waterClip",["$rootScope","$timeout","clipService","messageService","mapService",function(t,e,n,r,o){return{templateUrl:"water/clip/clip.html",scope:{bounds:"=",trigger:"=",drawn:"&"},link:function(i,a){i.clip=n.data.clip,i.typing=!1,"undefined"==typeof i.showBounds&&(i.showBounds=!1),o.getMap().then(function(t){i.$watch("bounds",function(t){t&&i.trigger?e(function(){i.initiateDraw()}):t||n.cancelDraw()})}),t.$on("icsm.clip.draw",function(t,n){n&&"oversize"===n.message?(i.oversize=!0,e(function(){delete i.oversize},6e3)):delete i.oversize}),i.initiateDraw=function(){r.info("Click on the map and drag to define your area of interest."),n.initiateDraw()}}}}]).factory("clipService",["$q","$rootScope","drawService",function(t,e,n){function r(t){var e=o.data.clip;return e.xMax=t.bounds.getEast().toFixed(5),e.xMin=t.bounds.getWest().toFixed(5),e.yMax=t.bounds.getNorth().toFixed(5),e.yMin=t.bounds.getSouth().toFixed(5),o.data.area=(e.xMax-e.xMin)*(e.yMax-e.yMin),o.data}var o={data:{clip:{}},initiateDraw:function(){e.$broadcast("clip.initiate.draw",{started:!0});var t=this.data.clip;return delete t.xMin,delete t.xMax,delete t.yMin,delete t.yMax,delete t.area,n.drawRectangle({retryOnOversize:!1})},cancelDraw:function(){n.cancelDrawRectangle()},setClip:function(t){return r(t)}};return e.$on("bounds.drawn",function(t,n){console.log("data",n),o.setClip(n);var r=o.data.clip;e.$broadcast("icsm.clip.drawn",r),e.$broadcast("icsm.bounds.draw",[r.xMin,r.yMin,r.xMax,r.yMax])}),o}]);var DownloadCtrl=function(t){t.data().then(function(t){this.data=t}.bind(this)),this.remove=function(){t.clear()},this.changeEmail=function(e){t.setEmail(e)}},DownloadService=function(t,e,n,r,o){var i="download_email",a="Download Layers",l={zoom:null,center:null,layer:null},c=null,s={getLayerGroup:function(){return r.getGroup(a)},setState:function(t){function e(){[[t.bounds.yMin,t.bounds.xMin],[t.bounds.yMax,t.bounds.xMax]];l.layer&&r.getGroup(a).removeLayer(l.layer)}function n(t){l.layer&&(r.clearGroup(a),l.layer=null)}t?e():n()},decorate:function(){var t=c.item;c.item.download=!0,t.processsing||(t.processing={clip:{xMax:null,xMin:null,yMax:null,yMin:null}})},setEmail:function(t){o.setItem(i,t)},getEmail:function(){return o.getItem(i).then(function(t){return c.email=t,t})},data:function(){return c?e.when(c):t.get("icsm/resources/config/icsm.json").then(function(t){return c=t.data,s.decorate(),c})}};return s};angular.module("water.download",[]).controller("DownloadCtrl",DownloadCtrl).factory("downloadService",DownloadService),DownloadCtrl.$inject=["downloadService"],DownloadService.$inject=["$http","$q","$rootScope","mapService","storageService"];var ContributorsService=function(t){var e={show:!1,ingroup:!1,stick:!1};return t.get("icsm/resources/config/contributors.json").then(function(t){e.orgs=t.data}),{getState:function(){return e}}};angular.module("icsm.contributors",[]).directive("icsmContributors",["$interval","contributorsService",function(t,e){return{templateUrl:"water/contributors/contributors.html",scope:{},link:function(n,r){var o=void 0;n.contributors=e.getState(),n.over=function(){t.cancel(o),n.contributors.ingroup=!0},n.out=function(){o=t(function(){n.contributors.ingroup=!1},1e3)},n.unstick=function(){n.contributors.ingroup=n.contributors.show=n.contributors.stick=!1,r.find("a").blur()}}}}]).directive("icsmContributorsLink",["$interval","contributorsService",function(t,e){return{restrict:"AE",templateUrl:"water/contributors/show.html",scope:{},link:function(n){var r=void 0;n.contributors=e.getState(),n.over=function(){t.cancel(r),n.contributors.show=!0},n.toggleStick=function(){n.contributors.stick=!n.contributors.stick,n.contributors.stick||(n.contributors.show=n.contributors.ingroup=!1)},n.out=function(){r=t(function(){n.contributors.show=!1},700)}}}}]).factory("contributorsService",ContributorsService).filter("activeContributors",function(){return function(t){return t?t.filter(function(t){return t.enabled}):[]}}),ContributorsService.$inject=["$http"];var PaneCtrl=function(t){var e=this;t.data().then(function(t){e.data=t})},PaneService=function(){return{add:function(t){},remove:function(t){}}};angular.module("water.panes",[]).directive("waterPanes",["$rootScope","$timeout","mapService",function(t,e,n){return{templateUrl:"water/panes/panes.html",transclude:!0,restrict:"AE",scope:{defaultItem:"@",data:"="},link:function(t){console.log("HHHHHHHHHHHHHH4H")},controller:["$scope",function(r){var o=!1;t.$on("side.panel.change",function(t){function n(){var t=document.createEvent("HTMLEvents");t.initEvent("resize",!1,!0),window.dispatchEvent(t)}n(),e(n,100),e(n,200),e(n,300),e(n,500)}),r.view=r.defaultItem,t.$broadcast("view.changed",r.view,null),r.setView=function(e){var i=r.view;r.view===e?(e&&(o=!0),r.view=""):(e||(o=!0),r.view=e),t.$broadcast("view.changed",r.view,i),o&&n.getMap().then(function(t){t._onResize()})},e(function(){t.$broadcast("view.changed",r.view,null)},50)}]}}]).directive("icsmTabs",[function(){return{templateUrl:"water/panes/tabs.html",require:"^icsmPanes"}}]).controller("PaneCtrl",PaneCtrl).factory("paneService",PaneService),PaneCtrl.$inject=["paneService"],PaneService.$inject=[];var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),WaterRegionsService=function(){function t(e,n,r){_classCallCheck(this,t),this.$http=e,this.configService=n,this.mapService=r}return _createClass(t,[{key:"config",value:function(){return this.configService.getConfig("regions")}},{key:"features",value:function(){var t=this;return this.config().then(function(e){return t.$http.get(e.regionsUrl,{cache:!0}).then(function(t){return t.data.features})})}},{key:"draw",value:function(){var t=this;return this.promise?this.promise:(this.promise=this.config().then(function(e){return t.mapService.getMap().then(function(n){return t.features().then(function(r){var o=t.divisions=[],i=t.regions=[],a=t.divisionsMap={};r.forEach(function(t){var e=t.properties.Division;a[e]=a[e]||[],a[e].push(t)}),Object.keys(a).forEach(function(t,r){var l=a[t],c=e.divisionColors[r%e.divisionColors.length],s=L.geoJson(l,{onEachFeature:function(t,e){var n={layer:e,name:t.properties.RivRegName,feature:t,show:function(){this.layer.openPopup()},hide:function(){this.layer._map.closePopup()}};e.bindPopup(n.name),i.push(n),e.on("mouseover",function(){console.log("river",e)})},style:function(t){return{color:"black",fillOpacity:.2,fillColor:c,weight:1}}}),d=e.divisionOptions[t]||{center:s.getBounds().getCenter()},u=new L.marker(d.center,{opacity:.01});u.bindLabel(t,{noHide:!0,className:"regions-label",offset:[0,0]}),u.addTo(n),o.push({layer:s,name:t,marker:u,features:l})});var l=L.featureGroup(o.map(function(t){return t.layer}),{style:function(t){return{color:"black",fill:!0,fillColor:"red",weight:1}}}).on("mouseover",function(t){console.log("division",t)});l.addTo(n)})})}),this.promise)}},{key:"divisionColors",get:function(){return config.divisionColors}}]),t}();WaterRegionsService.$invoke=["$http","configService","mapService"],angular.module("water.regions",["water.select.division","water.select.region"]).directive("waterRegions",["$http","waterRegionsService","mapService",function(t,e,n){return{link:function(t){e.draw()}}}]).service("waterRegionsService",WaterRegionsService),angular.module("water.select.division",["water.regions"]).directive("selectDivision",["waterRegionsService",function(t){return{templateUrl:"water/select/division.html",scope:{state:"=",open:"="},link:function(e){t.draw().then(function(){e.divisions=t.divisions.sort(function(t,e){return t.name>e.name?1:-1})}),e.$watch("open",function(t){console.log("selected",t)}),e.hilight=function(t){t.marker.label._container.classList.add("over")},e.lolight=function(t){t.marker.label._container.classList.remove("over")}}}}]),angular.module("water.select.region",["water.select.service"]).directive("selectRegion",["waterRegionsService",function(t){return{templateUrl:"water/select/region.html",scope:{state:"="},link:function(e){t.draw().then(function(){e.regions=t.regions.sort(function(t,e){return t.name>e.name?1:-1})}),e.hilight=function(t){t.show()},e.lolight=function(t){t.hide()}}}}]);var SelectService=function(t,e,n,r,o,i){function a(){r(function(){v._executeQuery()},100)}var l="Search Layers",c="icsm/resources/config/water_select.json",s={text:"",daterange:{enabled:!1,upper:null,lower:null},bbox:{fromMap:!0,intersects:!0,yMax:null,yMin:null,xMax:null,xMin:null},defaultKeywords:[],keywords:[]},d={},u=void 0,p="#ff7800",g="darkblue",v={getSelectCriteria:function(){return s},getLayerGroup:function(){return u||(u=o.getGroup(l)),u},setKeywords:function(t){},setFilter:function(t){},refresh:function(){},getDaterange:function(){return s.daterange},more:function(){},_executeQuery:function(){t.get(c,{cache:!0}).then(function(t){v.getLayerGroup();var e=t.data;e.response.docs.forEach(function(t){v._decorateDataset(t),"group"===t.type&&t.docs.forEach(function(t){v._decorateDataset(t)})}),n.$broadcast("select.facet.counts",e),n.$broadcast("select.results.received",e)})},createLayer:function(t,e){var n=t.bbox,r=t.primaryId,o=void 0,i=void 0,a=void 0;if(a=d[r],!a){if(!n)return null;if(o=n.split(" "),4!==o.length)return null;e||(e=p),i=[[+o[1],+o[0]],[+o[3],+o[2]]],a=L.rectangle(i,{fill:!1,color:"#000000",width:3,clickable:!1}),d[r]=a}return this._decorateDataset(t),u.addLayer(a),a},_decorateDataset:function(t){function e(t){var e=void 0;return t?(e=t.split(/\s/g),{xMin:+e[0],xMax:+e[2],yMax:+e[3],yMin:+e[1]}):null}var n=d[t.primaryId];n?(t.layer=n,t.showLayer=!0):(t.layer=null,t.showLayer=!1,t.services=servicesFactory(t.dcUris),t.bounds=e(t.bbox))},showWithin:function(t){function e(t,e,n,r){var o=s.bbox;return t>o.xMin&&n<o.xMax&&e>o.yMin&&r<o.yMax}t.forEach(function(t){var n=t.bbox,r=void 0;n?(r=n.split(" "),4===r.length&&e(+r[0],+r[1],+r[2],+r[3])?v.createLayer(t):v.removeLayer(t)):v.removeLayer(t)})},toggle:function(t){t.showLayer?this.removeLayer(t):this.createLayer(t)},toggleAll:function(t){var e=this,n=t.some(function(t){return!t.showLayer});return t.forEach(function(t){n?t.showLayer||e.createLayer(t):t.showLayer&&e.removeLayer(t)}),!n},hideAll:function(t){t.forEach(function(t){t.showLayer&&v.removeLayer(t)})},hilight:function(t){t.setStyle({color:g})},lolight:function(t){t.setStyle({color:p})},removeLayer:function(t){var e=t.primaryId,n=d[e];n&&(u.removeLayer(n),delete d[e]),this._decorateDataset(t)}};return a(),v},servicesFactory=function(t){function e(t){var e=this;this.uris=t,this.container={wcs:null,wms:null},t?this.services=t.map(function(t){var r=new n(t);return e.container.wcs=r.isWcs()?r:e.container.wcs,e.container.wms=r.isWms()?r:e.container.wms,r}):this.services=[],this.hasWcs=function(){return null!==this.container.wcs},this.hasWms=function(){return null!==this.container.wms},this.getWcs=function(){return this.container.wcs},this.getWms=function(){return this.container.wms},this.remove=function(){this.services.forEach(function(t){t.remove()})}}function n(t){var e=$(t);this.protocol=e.attr("protocol"),this.url=e.text(),this.layerNames=e.attr("layerNames"),this.name=e.attr("name"),this.description=e.attr("description"),this.handlers=[],this.isWcs=function(){return this.protocol===r.WCS},this.isWfs=function(){return this.protocol===r.WFS},this.isWms=function(){return this.protocol===r.WMS},this.isSupported=function(){return"undefined"==typeof r[this.protocol]},this.addHandler=function(t){this.handlers.push(t)},this.removeHandler=function(t){this.handlers.push(t)},this.remove=function(){var t=this;this.handlers.forEach(function(e){e.remove&&e.remove(t)}),this.handlers=[]},this.getUrl=function(){return url?url.indexOf("?")<0?void 0:url.substr(0,url.indexOf("?")):null}}var r={WCS:"OGC:WCS",WFS:"OGC:WFS",WMS:"OGC:WMS"};return new e(t)};angular.module("water.select.service",[]).factory("selectService",SelectService),SelectService.$inject=["$http","$q","$rootScope","$timeout","mapService","configService"];var SelectCriteriaCtrl=function(t){this.criteria=t.getSelectCriteria(),this.refresh=function(){t.refresh()}},SelectCtrl=function(t,e,n,r){var o=this,i=void 0;t.$on("select.results.received",function(t,e){n.remove(i),o.data=e}),e.getConfig("facets").then(function(t){o.hasKeywords=t&&t.keywordMapped&&t.keywordMapped.length>0}),this.select=function(){n.remove(i),i=n.add("Selecting",3e3,!0),r.setFilter(this.filter)},this.toggle=function(t){r.toggle(t)},this.toggleAll=function(){r.toggleAll(this.data.response.docs)},this.showWithin=function(){r.showWithin(this.data.response.docs)},this.allShowing=function(){return!(!this.data||!this.data.response)&&!this.data.response.docs.some(function(t){return!t.showLayer})},this.anyShowing=function(){return!(!this.data||!this.data.response)&&this.data.response.docs.some(function(t){return t.showLayer})},this.hideAll=function(){r.hideAll(this.data.response.docs)},this.hilight=function(t){t.layer&&r.hilight(t.layer)},this.lolight=function(t){t.layer&&r.lolight(t.layer)}};angular.module("water.select",["water.select.service"]).controller("SelectCtrl",SelectCtrl).controller("SelectCriteriaCtrl",SelectCriteriaCtrl).directive("waterSelect",[function(){return{templateUrl:"water/select/select.html",link:function(t,e,n){}}}]).directive("selectDoc",[function(){return{templateUrl:"water/select/doc.html",link:function(t,e,n){}}}]).directive("selectGroup",[function(){return{templateUrl:"water/select/group.html",scope:{group:"="},link:function(t,e,n){}}}]).filter("pubDate",function(){return function(t){var e;return t?(e=new Date(t),e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear()):"-"}}).filter("authors",function(){return function(t){return t?t.join(", "):"-"}}).filter("truncate",function(){return function(t,e){return t&&t.length>e-3?t.substr(0,e-3)+"...":t}}),SelectCriteriaCtrl.$inject=["selectService"],SelectCtrl.$inject=["$rootScope","configService","flashService","selectService"],angular.module("water.toolbar",[]).directive("elevationToolbar",[function(){return{restrict:"AE",templateUrl:"water/toolbar/toolbar.html",controller:"toolbarLinksCtrl",transclude:!0}}]).controller("toolbarLinksCtrl",["$scope","configService",function(t,e){var n=this;e.getConfig().then(function(t){n.links=t.toolbarLinks}),t.item="",t.toggleItem=function(e){t.item=t.item===e?"":e}}]);var VectorGeoprocessService=function(t,e,n,r,o,i,a,l,c){function s(t){return d}var d,u,p=null;return c.config().then(function(t){d=t.serviceUrlTemplate}),a.getMap().then(function(t){u=t}),{queryLayer:function(t,n){var r=e.defer(),o=L.esri.featureLayer({url:t.url}),i=L.latLngBounds([n.yMin,n.xMin],[n.yMax,n.xMax]);return o.query().intersects(i).ids(function(t,e){t?r.reject(t):r.resolve(e)}),r.promise},outFormats:function(){return c.outFormats()},handleShowClip:function(t){this.removeClip(),p=L.rectangle([[t.yMin,t.xMin],[t.yMax,t.xMax]],{weight:2,opacity:.9,fill:!1,color:"#000000",width:3,clickable:!1}),p.addTo(u)},removeClip:function(){p&&(u.removeLayer(p),p=null)},addLayer:function(t){return L.tileLayer.wms(t.parameters[0],t.parameters[1]).addTo(u)},removeLayer:function(t){u.removeLayer(t)},initiateJob:function(t,e){var n=s(t),r=t.processing,a=r.bboxSelected?r.clip:{yMin:null,yMax:null,xMax:null,xMin:null},l={bbox:{yMin:a.yMin,yMax:a.yMax,xMin:a.xMin,xMax:a.xMax},geocatId:t.primaryId,crs:r.outCoordSys.code,format:r.outFormat.code},c=[],d=[];t.docs.forEach(function(t){t.selected&&(c.push(t.primaryId),d.push(t.code))}),angular.forEach({id:c.join(" "),features_selected:d.join(" "),filename:r.filename?r.filename:"",outFormat:r.outFormat.code,file_format_raster:"",ymin:a.yMin,ymax:a.yMax,xmin:a.xMin,xmax:a.xMax,division_name:r.divisionSelected?r.division:"",river_reg_name:r.regionSelected?r.region:"",outCoordSys:r.outCoordSys.code,email:e},function(t,e){n=n.replace("{"+e+"}",t)}),$("#launcher")[0].src=n,o.setEmail(e),i("send","event","nedf","click","FME data export: "+JSON.stringify(l))},getConfig:function(){return c.config()}}};angular.module("water.vector.geoprocess",[]).directive("vectorGeoprocess",["$http","$q","$timeout","vectorGeoprocessService","flashService","messageService","vectorService",function(t,e,n,r,o,i,a){return{restrict:"AE",templateUrl:"water/vector/geoprocess.html",scope:{data:"=",open:"="},link:function(t){function l(){c(),t.data.referenceLayer&&(h=r.addLayer(t.data.referenceLayer))}function c(){h&&r.removeLayer(h)}function s(t){var e=(t.xMax-t.xMin)*(t.yMax-t.yMin);return e<1e-11||t.xMax<t.xMin}function d(e){var n=Math.abs((e.xMax-e.xMin)*(e.yMax-e.yMin));return t.data.restrictSize&&n>t.data.restrictSize}function u(t,e){function n(t){return angular.isUndefined(t)||""===t||null===t}var r=!1,o=!1;return!(!e||n(t.xMax)||n(t.xMin)||n(t.yMax)||n(t.yMin))&&(o=r=+t.xMax<+e.xMin,r&&(t.xMax=+e.xMin),r=+t.xMax>+e.xMax,o=o||r,r&&(t.xMax=+e.xMax),r=+t.xMin<+e.xMin,o=o||r,r&&(t.xMin=+e.xMin),r=+t.xMin>+t.xMax,o=o||r,r&&(t.xMin=t.xMax),r=+t.yMax<+e.yMin,o=o||r,r&&(t.yMax=+e.yMin),r=+t.yMax>+e.yMax,o=o||r,r&&(t.yMax=+e.yMax),r=+t.yMin<+e.yMin,o=o||r,r&&(t.yMin=+e.yMin),r=+t.yMin>+t.yMax,o=o||r,r&&(t.yMin=+t.yMax),o)}function p(t){t.xMax=null===t.xMax?null:+t.xMax,t.xMin=null===t.xMin?null:+t.xMin,t.yMax=null===t.yMax?null:+t.yMax,t.yMin=null===t.yMin?null:+t.yMin}function g(t){return t&&angular.isNumber(t.xMax)&&angular.isNumber(t.xMin)&&angular.isNumber(t.yMax)&&angular.isNumber(t.yMin)&&!d(t)&&!s(t)}var v=void 0,m=void 0,h=void 0;a.outFormats().then(function(e){t.outFormats=e}),t.$watch("data",function(e,n){n&&(r.removeClip(),c()),e&&e!==n&&(t.stage="bbox",l())}),t.$watch("open",function(t){console.log("pone"+t)}),t.$watchGroup(["data.processing.clip.xMax","data.processing.clip.xMin","data.processing.clip.yMax","data.processing.clip.yMin"],function(t,a,c){function s(){var t=e.defer();if(d=c.drawn(),d&&d.code)switch(d.code){case"oversize":n(function(){o.remove(v),i.error("The selected area is too large to process. Please restrict to approximately "+Math.sqrt(c.data.restrictSize)+" degrees square."),c.stage="bbox",l(),t.resolve(d)});break;case"undersize":n(function(){o.remove(v),i.error("X Min and Y Min should be smaller than X Max and Y Max, respectively. Please update the drawn area."),c.stage="bbox",l(),t.resolve(d)});break;default:return e.when(d)}return t.promise}var d,u;m&&(n.cancel(m),m=null),c.data&&c.data.processing&&c.data.processing.clip&&null!==c.data.processing.clip.xMax&&(v=o.add("Validating selected area...",3e3),c.checkingOrFailed=!!u,m=n(function(){s().then(function(t){try{t&&"success"==t.code&&(r.handleShowClip(c.data.processing.clip),c.checkingOrFailed=!1)}catch(e){c.checkingOrFailed=!1}})},2e3))}),t.selectedDivision=function(){console.log("selected division")},t.selectedRegion=function(){console.log("selected region")},t.drawn=function(){return r.removeClip(),p(t.data.processing.clip),u(t.data.processing.clip,t.data.bounds)&&(v=o.add("Redrawn to fit within data extent",5e3)),d(t.data.processing.clip)?{code:"oversize"}:s(t.data.processing.clip)?{code:"undersize"}:null===t.data.processing.clip.xMax?{code:"incomplete"}:g(t.data.processing.clip)?{code:"success"}:{code:"invalid"}},t.startExtract=function(){t.allDataSet()&&(i.info("Your request has been sent for processing. You will be notified by email on completion of the job."),o.add("You can select another area for processing.",1e4),r.initiateJob(t.data,t.email),t.data.download=!1)},t.allDataSet=function(){var e=t.data&&t.data.processing?t.data.processing:null;return e&&t.email&&(e.divisionSelected&&e.division||e.regionSelected&&e.region||e.bboxSelected&&g(e.clip))&&e.outCoordSys&&e.outFormat},t.validSansEmail=function(){var e=t.data&&t.data.processing?t.data.processing:null;return e&&(e.divisionSelected&&e.division||e.regionSelected&&e.region||e.bboxSelected&&g(e.clip))&&e.outCoordSys&&e.outFormat},t.validClip=function(t){return t&&t.processing&&g(t.processing.clip)},r.getConfig().then(function(e){t.config=e})}}}]).factory("vectorGeoprocessService",VectorGeoprocessService).filter("sysIntersect",function(){return function(t,e){return e&&angular.isNumber(e.xMin)&&angular.isNumber(e.xMax)&&angular.isNumber(e.yMin)&&angular.isNumber(e.yMax)?t.filter(function(t){return!t.extent||t.extent.xMin<=e.xMin&&t.extent.xMax>=e.xMax&&t.extent.yMin<=e.yMin&&t.extent.yMax>=e.yMax}):t}}),VectorGeoprocessService.$invoke=["$http","$q","$timeout","configService","downloadService","ga","mapService","storageService","vectorService"],angular.module("water.vector",[]).directive("vectorSelect",[function(){return{templateUrl:"water/vector/vector.html",controllerAs:"vect",controller:"VectorCtrl"}}]).controller("VectorCtrl",["selectService","vectorService",function(t,e){var n=this;e.config().then(function(t){n.config=t,n.group=t.group}),this.hilight=function(e){e.layer&&t.hilight(e.layer)},this.lolight=function(e){e.layer&&t.lolight(e.layer)}}]).factory("vectorService",["$http","$q",function(t,e){var n,r,o={};return o.config=function(){if(r)return e.when(r);var o=e.defer();return n?n.push(o):(n=[o],t.get("icsm/resources/config/water_vector.json",{cache:!0}).then(function(t){r=t.data,n.forEach(function(t){t.resolve(r)})})),o.promise},o.outFormats=function(){return o.config().then(function(t){return t.refData.vectorFileFormat})},o}]);var VectorDownloadCtrl=function(t){var e=this;t.data().then(function(t){e.data=t}),this.remove=function(){t.clear()},this.changeEmail=function(e){t.setEmail(e)}},VectorDownloadService=function(t,e,n,r,o){var i="download_email",a="Download Layers",l={zoom:null,center:null,layer:null},c={email:null,item:null},s={getLayerGroup:function(){return r.getGroup(a)},setState:function(t){function e(){var e=[[t.bounds.yMin,t.bounds.xMin],[t.bounds.yMax,t.bounds.xMax]];l.layer&&r.getGroup(a).removeLayer(l.layer),t.queryLayer||(l.layer=L.rectangle(e,{color:"black",fill:!1}),r.getGroup(a).addLayer(l.layer))}function n(t){r.clearGroup(a),l.layer=null}t?e():n(map)},add:function(t){this.clear(),c.item=t,c.item.download=!0,t.processsing||(t.processing={clip:{xMax:null,xMin:null,yMax:null,yMin:null}})},clear:function(){c.item&&(c.item.download=!1,c.item=null)},setEmail:function(t){o.setItem(i,t)},getEmail:function(){return o.getItem(i).then(function(t){return c.email=t,t})},data:function(){return e.when(c)}};return s};angular.module("water.vector.download",["common.geoprocess"]).directive("vectorPopup",["vectorDownloadService",function(t){return{restrict:"AE",templateUrl:"water/vector/popup.html",link:function(e){t.data().then(function(n){e.data=n,e.$watch("data.item",function(n,r){n&&(e.stage="bbox"),(n||r)&&t.setState(n)})})}}}]).directive("vectorDownload",["vectorDdownloadService",function(t){return{restrict:"AE",controller:"VectorDownloadCtrl",templateUrl:"water/vector/popup.html",link:function(){}}}]).directive("commonVectorDownload",["vectorDownloadService",function(t){return{templateUrl:"water/vector/download.html",controller:"VectorDownloadCtrl",link:function(e,n){t.data().then(function(t){e.data=t}),e.$watch("data.item",function(e,n){(e||n)&&t.setState(e)})}}}]).directive("vectorAdd",["$rootScope","vectorDownloadService","flashService",function(t,e,n){return{templateUrl:"water/vector/add.html",restrict:"AE",scope:{group:"="},link:function(r,o){r.toggle=function(){r.group.download?e.clear(r.group):(n.add("Select an area of interest that intersects the highlighted areas."),e.add(r.group),r.group.sysId&&t.$broadcast("hide.wms",r.group.sysId))},r.someSelected=function(){if(!r.group||!r.group.docs)return!1;var t=r.group.docs.some(function(t){return t.selected});return t}}}}]).controller("VectorDownloadCtrl",VectorDownloadCtrl).factory("vectorDownloadService",VectorDownloadService),VectorDownloadCtrl.$inject=["vectorDownloadService"],VectorDownloadService.$inject=["$http","$q","$rootScope","mapService","storageService"];var DownloadCtrl=function(t){t.data().then(function(t){this.data=t}.bind(this)),this.remove=function(){t.clear()},this.changeEmail=function(e){t.setEmail(e)}},DownloadService=function(t,e,n,r,o){var i="download_email",a="Download Layers",l={zoom:null,center:null,layer:null},c=null,s={getLayerGroup:function(){return r.getGroup(a)},setState:function(t){function e(){[[t.bounds.yMin,t.bounds.xMin],[t.bounds.yMax,t.bounds.xMax]];l.layer&&r.getGroup(a).removeLayer(l.layer)}function n(t){l.layer&&(r.clearGroup(a),l.layer=null)}t?e():n()},decorate:function(){var t=c.item;c.item.download=!0,t.processsing||(t.processing={clip:{xMax:null,xMin:null,yMax:null,yMin:null}})},setEmail:function(t){o.setItem(i,t)},getEmail:function(){return o.getItem(i).then(function(t){return c.email=t,t})},data:function(){return c?e.when(c):t.get("icsm/resources/config/icsm.json").then(function(t){return c=t.data,s.decorate(),c})}};return s};angular.module("water.view",[]).directive("waterView",["downloadService",function(t){return{templateUrl:"water/view/view.html",controller:"DownloadCtrl",link:function(e,n){t.data().then(function(t){e.data=t}),e.$watch("data.item",function(e,n){(e||n)&&t.setState(e)})}}}]).controller("DownloadCtrl",DownloadCtrl).factory("downloadService",DownloadService),DownloadCtrl.$inject=["downloadService"],DownloadService.$inject=["$http","$q","$rootScope","mapService","storageService"],angular.module("water.templates",[]).run(["$templateCache",function(t){t.put("water/clip/clip.html",'<div class="well well-sm" style="margin-bottom:5px">\r\n\t<div class="container-fluid">\r\n\t\t<div class="row">\r\n\t\t\t<div class="col-md-12" style="padding:0">\r\n\t\t\t\t<div class="" role="group" aria-label="...">\r\n\t\t\t\t\t<button ng-click="initiateDraw()" ng-disable="client.drawing"\r\n                      tooltip-append-to-body="true" tooltip-placement="bottom" uib-tooltip="Enable drawing of a bounding box. On enabling, click on the map and drag diagonally"\r\n\t\t\t\t\t\tclass="btn btn-primary btn-default">Select an area...</button>\r\n\t\t\t\t\t<button ng-click="showInfo = !showInfo" tooltip-placement="bottom" uib-tooltip="Information." style="float:right" class="btn btn-primary btn-default"><i class="fa fa-info"></i></button>\r\n\t\t\t\t</div>\r\n\t\t\t\t<exp-info title="Selecting an area" show-close="true" style="width:450px;position:fixed;top:200px;right:40px" is-open="showInfo">\r\n\t\t\t\t\t<icsm-info-bbox></icsm-info-bbox>\r\n            </exp-info>\r\n            <div class="row" ng-hide="(!clip.xMin && clip.xMin !== 0) || oversize" style="padding-top:7px;">\r\n               <div class="col-md-12 ng-binding">\r\n                  Selected bounds: {{clip.xMin | number : 4}}° west,\r\n                     {{clip.yMax | number : 4}}° north,\r\n                     {{clip.xMax | number : 4}}° east,\r\n                     {{clip.yMin | number : 4}}° south\r\n               </div>\r\n            </div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>'),t.put("water/clip/infobbox.html",'<div class="">\r\n\t<strong style="font-size:120%">Select an area of interest.</strong>\r\n   By hitting the "Select an area..." button an area on the map can be selected with the mouse by clicking a\r\n   corner and while holding the left mouse button\r\n\tdown drag diagonally across the map to the opposite corner.\r\n\t<br/>\r\n\tClicking the "Select an area..." button again allows replacing a previous area selection. <br/>\r\n\t<strong>Notes:</strong>\r\n   <ul>\r\n      <li>The data does not cover all of Australia.</li>\r\n      <li>Restrict a search area to below four square degrees. eg 2x2 or 1x4</li>\r\n   </ul>\r\n\t<p style="padding-top:5px"><strong>Hint:</strong> If the map has focus, you can use the arrow keys to pan the map.\r\n\t\tYou can zoom in and out using the mouse wheel or the "+" and "-" map control on the top left of the map. If you\r\n\t\tdon\'t like the position of your drawn area, hit the "Draw" button and draw a new bounding box.\r\n\t</p>\r\n</div>'),t.put("water/contributors/contributors.html",'<span class="contributors" ng-mouseenter="over()" ng-mouseleave="out()"\r\n      ng-class="(contributors.show || contributors.ingroup || contributors.stick) ? \'transitioned-down\' : \'transitioned-up\'">\r\n   <button class="undecorated contributors-unstick" ng-click="unstick()" style="float:right">X</button>\r\n   <div ng-repeat="contributor in contributors.orgs | activeContributors" style="text-align:cnter">\r\n      <a ng-href="{{contributor.href}}" name="contributors{{$index}}" title="{{contributor.title}}" target="_blank">\r\n         <img ng-src="{{contributor.image}}" alt="{{contributor.title}}" class="elvis-logo" ng-class="contributor.class"></img>\r\n      </a>\r\n   </div>\r\n</span>'),t.put("water/contributors/show.html",'<a ng-mouseenter="over()" ng-mouseleave="out()" class="contributors-link" title="Click to lock/unlock contributors list."\r\n      ng-click="toggleStick()" href="#contributors0">Contributors</a>'),t.put("water/panes/panes.html",'<div class="mapContainer" class="col-md-12" style="padding-right:0"  ng-attr-style="right:{{right.width}}">\r\n   <span common-baselayer-control class="baselayer-slider" max-zoom="16" title="Satellite to Topography bias on base map."></span>\r\n   <div class="panesMapContainer" geo-map configuration="data.map">\r\n      <geo-extent></geo-extent>\r\n      <common-feature-info></common-feature-info>\r\n      <icsm-layerswitch></icsm-layerswitch>\r\n   </div>\r\n   <div class="base-layer-controller">\r\n      <div geo-draw data="data.map.drawOptions" line-event="elevation.plot.data" rectangle-event="bounds.drawn"></div>\r\n   </div>\r\n   <water-regions></water-regions>\r\n   <restrict-pan bounds="data.map.position.bounds"></restrict-pan>\r\n</div>'),t.put("water/panes/tabs.html",'<!-- tabs go here -->\r\n<div id="panesTabsContainer" class="paneRotateTabs" style="opacity:0.9" ng-style="{\'right\' : contentLeft +\'px\'}">\r\n\r\n   <div class="paneTabItem" style="width:60px; opacity:0">\r\n\r\n   </div>\r\n   <div class="paneTabItem" ng-class="{\'bold\': view == \'download\'}" ng-click="setView(\'download\')">\r\n      <button class="undecorated">Datasets Download</button>\r\n   </div>\r\n   <!--\r\n\t<div class="paneTabItem" ng-class="{\'bold\': view == \'search\'}" ng-click="setView(\'search\')">\r\n\t\t<button class="undecorated">Search</button>\r\n\t</div>\r\n\t<div class="paneTabItem" ng-class="{\'bold\': view == \'maps\'}" ng-click="setView(\'maps\')">\r\n\t\t<button class="undecorated">Layers</button>\r\n\t</div>\r\n   -->\r\n   <div class="paneTabItem" ng-class="{\'bold\': view == \'downloader\'}" ng-click="setView(\'downloader\')">\r\n      <button class="undecorated">Products Download</button>\r\n   </div>\r\n   <div class="paneTabItem" ng-class="{\'bold\': view == \'glossary\'}" ng-click="setView(\'glossary\')">\r\n      <button class="undecorated">Glossary</button>\r\n   </div>\r\n   <div class="paneTabItem" ng-class="{\'bold\': view == \'help\'}" ng-click="setView(\'help\')">\r\n      <button class="undecorated">Help</button>\r\n   </div>\r\n</div>'),
t.put("water/select/division.html",'<div class="row" ng-repeat="division in divisions">\r\n   <div class="col-md-12" ng-mouseenter="hilight(division)" ng-mouseleave="lolight(division)">\r\n      <label>\r\n         <input type="radio" ng-model="state.division" name="divisionsRadio" value="{{division.name}}">\r\n         {{division.name}}\r\n      </label>\r\n   </div>\r\n</div>'),t.put("water/select/doc.html",'<div ng-class-odd="\'odd\'" ng-class-even="\'even\'" ng-mouseleave="select.lolight(doc)" ng-mouseenter="select.hilight(doc)">\r\n\t<span ng-class="{ellipsis:!expanded}" tooltip-enable="!expanded" style="width:100%;display:inline-block;"\r\n\t\t\ttooltip-class="selectAbstractTooltip" tooltip="{{doc.abstract | truncate : 250}}" tooltip-placement="bottom">\r\n\t\t<button type="button" class="undecorated" ng-click="expanded = !expanded" title="Click to see more about this dataset">\r\n\t\t\t<i class="fa pad-right fa-lg" ng-class="{\'fa-caret-down\':expanded,\'fa-caret-right\':(!expanded)}"></i>\r\n\t\t</button>\r\n\t\t<download-add item="doc" group="group"></download-add>\r\n\t\t<common-wms data="doc"></common-wms>\r\n\t\t<common-bbox data="doc" ng-if="doc.showExtent"></common-bbox>\r\n\t\t<common-cc></common-cc>\r\n\t\t<common-metaview url="\'https://ecat.ga.gov.au/geonetwork/srv/eng/search#!\' + doc.primaryId + \'/xml\'" container="select" item="doc"></common-metaview>\r\n\t\t<a href="https://ecat.ga.gov.au/geonetwork/srv/eng/search#!{{doc.primaryId}}" target="_blank" ><strong>{{doc.title}}</strong></a>\r\n\t</span>\r\n\t<span ng-class="{ellipsis:!expanded}" style="width:100%;display:inline-block;padding-right:15px;">\r\n\t\t{{doc.abstract}}\r\n\t</span>\r\n\t<div ng-show="expanded" style="padding-bottom: 5px;">\r\n\t\t<h5>Keywords</h5>\r\n\t\t<div>\r\n\t\t\t<span class="badge" ng-repeat="keyword in doc.keywords track by $index">{{keyword}}</span>\r\n\t\t</div>\r\n\t</div>\r\n</div>'),t.put("water/select/group.html",'<div class="panel panel-default" style="margin-bottom:-5px;" >\r\n\t<div class="panel-heading"><common-wms data="group"></common-wms> <strong>{{group.title}}</strong></div>\r\n\t<div class="panel-body">\r\n   \t\t<div ng-repeat="doc in group.docs">\r\n   \t\t\t<div select-doc doc="doc" group="group"></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),t.put("water/select/region.html",'<div class="row" ng-repeat="region in regions">\r\n   <div class="col-md-12" ng-mouseenter="hilight(region)" ng-mouseleave="lolight(region)">\r\n      <label>\r\n         <input type="radio" ng-model="state.region" name="regionsRadio" value="{{region.name}}">\r\n         {{region.name}}\r\n      </label>\r\n   </div>\r\n</div>'),t.put("water/select/select.html",'<div ng-controller="SelectCtrl as select">\r\n\t<div style="position:relative;padding:5px;padding-left:10px;" class="scrollPanel" ng-if="!select.selected">\r\n\t\t<div class="panel panel-default" style="margin-bottom:-5px">\r\n  \t\t\t<div class="panel-heading">\r\n  \t\t\t\t<h3 class="panel-title">Available datasets</h3>\r\n  \t\t\t</div>\r\n  \t\t\t<div class="panel-body">\r\n\t\t\t\t<div ng-repeat="doc in select.data.response.docs" style="padding-bottom:7px">\r\n\t\t\t\t\t<div select-doc ng-if="doc.type == \'dataset\'" doc="doc"></div>\r\n\t\t\t\t\t<select-group ng-if="doc.type == \'group\'" group="doc"></select-group>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div vector-select></div>\r\n  \t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div style="position:relative;padding:5px;padding-left:10px;" class="scrollPanel" ng-if="select.selected" common-item-metaview container="select"></div>\r\n</div>'),t.put("water/toolbar/toolbar.html",'<div class="elevation-toolbar noPrint">\r\n   <div class="toolBarContainer">\r\n      <div>\r\n         <ul class="left-toolbar-items">\r\n            <div class="btn-group searchBar" ng-show="root.whichSearch != \'region\'">\r\n               <div class="input-group input-group-custom" geo-search >\r\n                  <input type="text" ng-autocomplete ng-model="values.from.description" options=\'{country:"au"}\' size="32" title="Select a locality to pan the map to."\r\n                     class="form-control" aria-label="...">\r\n                  <div class="input-group-btn">\r\n                     <button ng-click="zoom(false)" exp-ga="[\'send\', \'event\', \'icsm\', \'click\', \'zoom to location\']" class="btn btn-default" title="Pan and potentially zoom to location.">\r\n                        <i class="fa fa-search"></i>\r\n                     </button>\r\n                  </div>\r\n               </div>\r\n            </div>\r\n         </ul>\r\n         <ul class="right-toolbar-items">\r\n            <li>\r\n               <panel-trigger panel-id="download" panel-width="590px" name="Download" default="default" icon-class="fa-list" title="Select an area of interest and select datasets for download"></panel-trigger>\r\n            </li>\r\n            <li>\r\n               <panel-trigger panel-id="help" panel-width="590px" name="Help" icon-class="fa-question-circle-o" title="Show help"></panel-trigger>\r\n            </li>\r\n            <li>\r\n               <panel-trigger panel-id="glossary" panel-width="590px" name="Glossary" icon-class="fa-book" title="Show glossary"></panel-trigger>\r\n            </li>\r\n            <li reset-page></li>\r\n         </ul>\r\n      </div>\r\n   </div>\r\n</div>'),t.put("water/side-panel/side-panel-left.html",'<div class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left" style="width: {{left.width}}px;" ng-class="{\'cbp-spmenu-open\': left.active}">\r\n    <a href="" title="Close panel" ng-click="closeLeft()" style="z-index: 1200">\r\n        <span class="glyphicon glyphicon-chevron-left pull-right"></span>\r\n    </a>\r\n    <div ng-show="left.active === \'legend\'" class="left-side-menu-container">\r\n        <legend url="\'img/AustralianTopogaphyLegend.png\'" title="\'Map Legend\'"></legend>\r\n    </div>\r\n</div>'),t.put("water/side-panel/side-panel-right.html",'<div class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-right noPrint" ng-attr-style="width:{{right.width}}" ng-class="{\'cbp-spmenu-open\': right.active}">\r\n    <a href="" title="Close panel" ng-click="closePanel()" style="z-index: 1">\r\n        <span class="glyphicon glyphicon-chevron-right pull-left"></span>\r\n    </a>\r\n\r\n    <div class="right-side-menu-container" ng-show="right.active === \'download\'" water-view></div>\r\n    <div class="right-side-menu-container" ng-show="right.active === \'glossary\'" icsm-glossary></div>\r\n    <div class="right-side-menu-container" ng-show="right.active === \'help\'" icsm-help></div>\r\n    <panel-close-on-event only-on="search" event-name="clear.button.fired"></panel-close-on-event>\r\n</div>\r\n'),t.put("water/vector/add.html","<button type='button' ng-disabled='!someSelected()' class='undecorated vector-add' ng-click='toggle()'>\r\n   <span class='fa-stack' tooltip-placement='right' uib-tooltip='Extract data from one or more vector types.'>\r\n\t   <i class='fa fa-lg fa-download' ng-class='{active:item.download}'></i>\r\n\t</span>\r\n</button>"),t.put("water/vector/download.html",""),t.put("water/vector/geoprocess.html",'<div class="container-fluido" style="overflow-x:hidden" ng-form>\r\n\t<div ng-show="stage==\'bbox\'">\r\n\t\t<div class="row">\r\n\t\t\t<div class="col-md-12">\r\n            <div uib-accordion>\r\n               <div uib-accordion-group class="panel" heading="By drawn bounding box" is-open="data.processing.bboxSelected">\r\n\t\t\t\t      <wizard-clip trigger="stage == \'bbox\'" drawn="drawn()" clip="data.processing.clip" bounds="data.bounds" open="data.processing.bboxSelected"></wizard-clip>\r\n               </div>\r\n               <div uib-accordion-group class="panel" heading="By division" is-open="data.processing.divisionSelected">\r\n                  <select-division state="data.processing" open="data.processing.divisionSelected"></select-division>\r\n               </div>\r\n               <div uib-accordion-group class="panel" heading="By river region" is-open="data.processing.regionSelected">\r\n                  <select-region state="data.processing" open="data.processing.regionSelected"></select-region>\r\n               </div>\r\n            </div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class="row" style="height:55px">\r\n \t\t\t<div class="col-md-12">\r\n\t\t\t\t<button class="btn btn-primary pull-right"\r\n                  ng-disabled="(data.processing.bboxSelected &&  (!validClip(data) || checkingOrFailed)) || (data.processing.divisionSelected && ! data.processing.division) || (data.processing.regionSelected && ! data.processing.region)"\r\n                  ng-click="stage=\'formats\'">Next</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class="well">\r\n\t\t\t<strong style="font-size:120%">Select an area of interest.</strong> There are two ways to select your area of interest:\r\n\t\t\t<ol>\r\n\t\t\t\t<li>Draw an area on the map with the mouse by clicking a corner and while holding the left mouse button\r\n\t\t\t\t\tdown drag diagonally across the map to the opposite corner or</li>\r\n\t\t\t\t<li>Type your co-ordinates into the areas above.</li>\r\n\t\t\t</ol>\r\n\t\t\tOnce drawn the points can be modified by the overwriting the values above or drawing another area by clicking the draw button again.\r\n\t\t\tEnsure you select from the highlighted areas as the data can be quite sparse for some data.<br/>\r\n\t\t\t<p style="padding-top:5px">\r\n\t\t\t<strong>Warning:</strong> Some extracts can be huge. It is best if you start with a small area to experiment with first. An email will be sent\r\n\t\t\twith the size of the extract. Download judiciously.\r\n\t\t\t</p>\r\n\t\t\t<p style="padding-top"><strong>Hint:</strong> If the map has focus, you can use the arrow keys to pan the map.\r\n\t\t\t\tYou can zoom in and out using the mouse wheel or the "+" and "-" map control on the top left of the map. If you\r\n\t\t\t\tdon\'t like the position of your drawn area, hit the "Draw" button and draw a new bounding box.\r\n\t\t\t</p>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<div ng-show="stage==\'formats\'">\r\n\t\t<div class="well">\r\n\t\t<div class="row">\r\n  \t\t\t<div class="col-md-3">\r\n\t\t\t\t<label for="vectorGeoprocessOutputFormat">\r\n\t\t\t\t\tOutput Format\r\n\t\t\t\t</label>\r\n\t\t\t</div>\r\n\t\t\t<div class="col-md-9">\r\n\t\t\t\t<select id="vectorGeoprocessOutputFormat" style="width:95%" ng-model="data.processing.outFormat" ng-options="opt.value for opt in config.refData.vectorFileFormat"></select>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class="row">\r\n\t\t\t<div class="col-md-3">\r\n\t\t\t\t<label for="geoprocessOutCoordSys">\r\n\t\t\t\t\tCoordinate System\r\n\t\t\t\t</label>\r\n\t\t\t</div>\r\n\t\t\t<div class="col-md-9">\r\n\t\t\t\t<select id="vectorGeoprocessOutCoordSys" style="width:95%" ng-model="data.processing.outCoordSys" ng-options="opt.value for opt in config.refData.outCoordSys | sysIntersect : data.processing.clip"></select>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t</div>\r\n\t\t<div class="row" style="height:55px">\r\n\t\t\t<div class="col-md-6">\r\n\t\t\t\t<button class="btn btn-primary" ng-click="stage=\'bbox\'">Previous</button>\r\n\t\t\t</div>\r\n\t\t\t<div class="col-md-6">\r\n\t\t\t\t<button class="btn btn-primary pull-right" ng-disabled="!validSansEmail(data)" ng-click="stage=\'email\'">Next</button>\r\n   \t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<div class="well">\r\n\t\t\t<strong style="font-size:120%">Data representation.</strong> Select how you want your data presented.<br/>\r\n\t\t\tOutput format is the structure of the data and you should choose a format compatible with the tools that you will use to manipulate the data.\r\n\t\t\t<ul>\r\n\t\t\t\t<li ng-repeat="format in outFormats"><strong>{{format.value}}</strong> - {{format.description}}</li>\r\n\t\t\t</ul>\r\n\t\t\tSelect what <i>coordinate system</i> or projection you would like. If in doubt select WGS84.<br/>\r\n\t\t\tNot all projections cover all of Australia. If the area you select is not covered by a particular projection then the option to download in that projection will not be available.\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<div ng-show="stage==\'email\'">\r\n\t\t<div class="well" exp-enter="stage=\'confirm\'">\r\n\t\t\t<div download-email></div>\r\n\t\t\t<br/>\r\n\t\t\t<div download-filename data="data.processing"></div>\r\n\t\t</div>\r\n\t\t<div class="row" style="height:55px">\r\n\t\t\t<div class="col-md-6">\r\n\t\t\t\t<button class="btn btn-primary" ng-click="stage=\'formats\'">Previous</button>\r\n\t\t\t</div>\r\n\t\t\t<div class="col-md-6">\r\n\t\t\t\t<button class="btn btn-primary pull-right" ng-disabled="!allDataSet(data)" ng-click="stage=\'confirm\'">Submit</button>\r\n   \t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class="well">\r\n\t\t\t<strong style="font-size:120%">Email notification</strong> The extract of data can take some time. By providing an email address we will be able to notify you when the job is complete. The email will provide a link to the extracted\r\n\t\t\tdata which will be packaged up as a single file. To be able to proceed you need to have provided:\r\n\t\t\t<ul>\r\n\t\t\t\t<li>An area of interest to extract the data (referred to as a bounding box).</li>\r\n\t\t\t\t<li>An output format.</li>\r\n\t\t\t\t<li>A valid coordinate system or projection.</li>\r\n\t\t\t\t<li>An email address to receive the details of the extraction.</li>\r\n\t\t\t\t<li><strong>Note:</strong>Email addresses need to be and are stored in the system.</li>\r\n\t\t\t</ul>\r\n\t\t\t<strong style="font-size:120%">Optional filename</strong> The extract of data can take some time. By providing an optional filename it will allow you\r\n\t\t\tto associate extracted data to your purpose for downloading data. For example:\r\n\t\t\t<ul>\r\n\t\t\t\t<li>myHouse will have a file named myHouse.zip</li>\r\n\t\t\t\t<li>Sorrento would result in a file named Sorrento.zip</li>\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<div ng-show="stage==\'confirm\'">\r\n\t\t<div class="row">\r\n\t\t\t<div class="col-md-12 abstractContainer">\r\n\t\t\t\t{{data.abstract}}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<h3>You have chosen:</h3>\r\n\t\t<table class="table table-striped">\r\n\t\t\t<tbody>\r\n\t\t\t\t<tr ng-if="data.processing.bboxSelected">\r\n\t\t\t\t\t<th>Area</th>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t<span style="display:inline-block; width: 10em">Lower left (lat/lng&deg;):</span> {{data.processing.clip.yMin | number : 6}}, {{data.processing.clip.xMin | number : 6}}<br/>\r\n\t\t\t\t\t\t<span style="display:inline-block;width: 10em">Upper right (lat/lng&deg;):</span> {{data.processing.clip.yMax | number : 6}}, {{data.processing.clip.xMax | number : 6}}\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr ng-if="data.processing.divisionSelected">\r\n\t\t\t\t\t<th>Division</th>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t{{data.processing.division}}\r\n               </td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr ng-if="data.processing.regionSelected">\r\n\t\t\t\t\t<th>River Region</th>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t{{data.processing.region}}\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<th>Output format</th>\r\n\t\t\t\t\t<td>{{data.processing.outFormat.value}}</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<th>Coordinate system</th>\r\n\t\t\t\t\t<td>{{data.processing.outCoordSys.value}}</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<th>Email address</th>\r\n\t\t\t\t\t<td>{{email}}</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr ng-show="data.processing.filename">\r\n\t\t\t\t\t<th>Filename</th>\r\n\t\t\t\t\t<td>{{data.processing.filename}}</td>\r\n\t\t\t\t</tr>\r\n\t\t\t</tbody>\r\n\t\t</table>\r\n\t\t<div class="row" style="height:55px">\r\n\t\t\t<div class="col-md-6">\r\n\t\t\t\t<button class="btn btn-primary" style="width:6em" ng-click="stage=\'email\'">Back</button>\r\n\t\t\t</div>\r\n\t\t\t<div class="col-md-6">\r\n\t\t\t\t<button class="btn btn-primary pull-right" ng-click="startExtract()">Confirm</button>\r\n   \t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>'),t.put("water/vector/popup.html",'<exp-modal icon-class="fa-download"  is-open="data.item.download" title="Download wizard" on-close="vdl.remove()">\r\n\t<div class="container-fluid downloadInner" >\r\n\t\t<div class="row">\r\n  \t\t\t<div class="col-md-12">\r\n\t\t\t\t<h4><common-wms data="vdl.data.item"></common-wms>\r\n\t\t\t\t\t<a href="https://ecat.ga.gov.au/geonetwork/srv/eng/search#!{{vdl.data.item.primaryId}}" target="_blank"><strong class="ng-binding">{{vdl.data.item.title}}</strong></a>\r\n\t\t\t\t</h4>\r\n   \t\t\t</div>\r\n\t\t</div>\r\n\t\t<vector-geoprocess data="vdl.data.item"></vector-geoprocess>\r\n\t</div>\r\n</exp-modal>'),t.put("water/vector/vector.html",'<div class="panel panel-default" style="margin-bottom:-5px;">\r\n   <div class="panel-heading">\r\n\t\t<vector-add group="vect.group"></vector-add>\r\n      <common-tile data="vect.group"></common-tile>\r\n\t\t<common-bbox data="vect.group"></common-bbox>\r\n\t\t<common-cc></common-cc>\r\n      <strong>{{vect.group.title}}</strong>\r\n   </div>\r\n   <div class="panel-body">\r\n      <div ng-repeat="doc in vect.group.docs">\r\n         <div ng-class-odd="\'odd\'" ng-class-even="\'even\'" style="padding-left:12px" ng-mouseleave="vect.lolight(doc)" ng-mouseenter="vect.hilight(doc)" >\r\n            <span style="width:100%;display:inline-block;padding-bottom:8px">\r\n               <input type="checkbox" class="vector-checkbox" ng-model="doc.selected">\r\n\t\t         <common-metaview url="\'https://ecat.ga.gov.au/geonetwork/srv/eng/search#!\' + doc.primaryId + \'/xml\'" container="select" item="doc"></common-metaview>\r\n\t\t         <a href="https://ecat.ga.gov.au/geonetwork/srv/eng/search#!{{doc.primaryId}}" target="_blank" tooltip-append-to-body="true"\r\n                           uib-tooltip="{{doc.abstract}}" tooltip-placement="auto bottom" tooltip-class="vector-tooltip">\r\n                  <strong>{{doc.title}}</strong>\r\n               </a>\r\n\t         </span>\r\n         </div>\r\n      </div>\r\n   </div>\r\n</div>'),t.put("water/view/view.html",'<div class="container-fluid downloadPane">\r\n   <water-clip data="data.item"></water-clip>\r\n   <div class="list-container">\r\n      <water-list></water-list>\r\n   </div>\r\n   <div class="downloadCont" icsm-search-continue></div>\r\n</div>')}]);